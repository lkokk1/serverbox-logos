name: Build and Deploy Logos

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y imagemagick

      # 映射表：把常见别名复制成 ServerBox 能识别的名字
      - name: Normalize filenames
        run: |
          mkdir -p logos
          # Arch Linux
          [ -f logos/archlinux.svg ] && cp logos/archlinux.svg logos/arch.svg || true
          [ -f logos/archlinux.png ] && cp logos/archlinux.png logos/arch.png || true
          # openSUSE
          [ -f logos/opensuse.svg ] && cp logos/opensuse.svg logos/suse.svg || true
          # Rocky Linux
          [ -f logos/rockylinux.svg ] && cp logos/rockylinux.svg logos/rocky.svg || true
          # Deepin
          [ -f logos/deepin.svg ] && cp logos/deepin.svg logos/deepin.svg || true
          # 其他发行版可按需添加

      - name: Convert logos
        run: |
          mkdir -p png
          for file in logos/*.{svg,png}; do
            [ -e "$file" ] || continue
            base=$(basename "$file" .svg)
            base=$(basename "$base" .png)

            # light 版本（白底）
            convert -background white -resize 256x256 "$file" "png/${base}-light.png"
            # dark 版本（透明背景）
            convert -background transparent -resize 256x256 "$file" "png/${base}-dark.png"
          done

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./png
